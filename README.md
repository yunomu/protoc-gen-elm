# protoc-gen-elm

`protoc-gen-elm` is a plugin for the Google Protocol Buffers compiler (`protoc`) that generates Elm types, JSON decoders, and JSON encoders from your `.proto` files.

This allows you to maintain a single source of truth for your data structures in `.proto` files and automatically generate the corresponding Elm code, ensuring your frontend and backend data models stay in sync.

## Features

-   **Elm Type Generation**: Generates Elm `type alias` for each Protobuf message.
-   **JSON Decoders**: Creates a `Json.Decode.Pipeline` based decoder for each message, ensuring robust JSON parsing.
-   **JSON Encoders**: Creates a `Json.Encode.object` based encoder for each message.
-   **Naming Convention**: Converts Protobuf's `snake_case` field names to Elm's `camelCase` convention.
-   **Repeated Fields**: Handles `repeated` fields by converting them to `List` types in Elm.
-   **File/Directory Naming**: Generates directory and file names in `UpperCamelCase` based on the proto package and filename.
-   **Header Comment**: Adds a "do not edit" comment to the top of each generated file, indicating that it is auto-generated.

## Prerequisites

Before using this tool, you need to have the following installed:

-   [Go](https://go.dev/doc/install) (to build the plugin)
-   [Protocol Buffer Compiler (`protoc`)](https://grpc.io/docs/protoc-installation/)

## Installation (Build)

To build the plugin, clone this repository and run the following command from the root directory. This will create a `protoc-gen-elm` executable in the current directory.

```shell
go build -o protoc-gen-elm .
```

## Usage

To generate Elm code from a `.proto` file, run the `protoc` command with the `protoc-gen-elm` plugin.

The basic command structure is as follows:

```shell
protoc --plugin=./protoc-gen-elm --elm_out=<OUTPUT_DIRECTORY> <YOUR_PROTO_FILE>.proto
```

-   `--plugin=./protoc-gen-elm`: Specifies the path to the compiled plugin executable.
-   `--elm_out=<OUTPUT_DIRECTORY>`: Specifies the directory where the generated Elm files should be placed. Typically, you would use `.` for the current directory.

### Example

Let's say you have a file named `test.proto`:

```protobuf
syntax = "proto3";

package test;

option go_package = "./test";

message User {
  string user_id = 1;
  string user_name = 2;
  int32 age = 3;
}

message UserList {
  repeated User users = 1;
}
```

To generate the Elm code for this file, run the following command:

```shell
protoc --plugin=./protoc-gen-elm --elm_out=. test.proto
```

This will generate a new file at `Test/Test.elm` with the following content:

```elm
-- DO NOT EDIT
--
-- This file is automatically generated by protoc-gen-elm.
-- Source: test.proto

module Test.Test exposing (..)

import Json.Decode as Decode
import Json.Decode.Pipeline as Pipeline
import Json.Encode as Encode

type alias User =
    { 
    userId : String,
    userName : String,
    age : Int
    }

userDecoder : Decode.Decoder User
userDecoder =
    Pipeline.decode User
        |> Pipeline.required "userId" Decode.string
        |> Pipeline.required "userName" Decode.string
        |> Pipeline.required "age" Decode.int

userEncoder : User -> Encode.Value
userEncoder user =
    Encode.object
        [ 
            ("userId", Encode.string user.userId),
            ("userName", Encode.string user.userName),
            ("age", Encode.int user.age)
        ]

type alias UserList =
    { 
    users : (List User)
    }

userListDecoder : Decode.Decoder UserList
userListDecoder =
    Pipeline.decode UserList
        |> Pipeline.required "users" (Decode.list userDecoder)

userListEncoder : UserList -> Encode.Value
userListEncoder userList =
    Encode.object
        [ 
            ("users", (Encode.list userEncoder userList.users))
        ]
```
